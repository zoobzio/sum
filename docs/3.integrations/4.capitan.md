---
title: capitan Integration
description: Event and signal system integration
author: zoobzio
published: 2026-01-26
updated: 2026-01-26
tags:
  - integration
  - events
  - capitan
  - signals
---

# capitan Integration

[capitan](https://github.com/zoobzio/capitan) is an event/signal system with structured logging integration. Sum's `Event[T]` type provides a type-safe wrapper around capitan signals.

## What capitan Provides

- Named signals for application events
- Typed fields for structured event data
- Severity levels (Debug, Info, Warn, Error)
- Hook-based listeners
- Integration with structured logging

## The Integration

Sum's `Event[T]` wraps capitan signals with generics:

```go
type Event[T any] struct {
    Signal capitan.Signal
    Key    capitan.GenericKey[T]
    level  capitan.Severity
}
```

This provides:
- Type-safe emission and listening
- Automatic variant derivation from `T`
- Severity-aware dispatch

## Creating Events

Use the constructor functions:

```go
import (
    "github.com/zoobzio/capitan"
    "github.com/zoobzio/sum"
)

// At package level
var (
    UserCreated = sum.NewInfoEvent[User](capitan.Signal("user.created"))
    UserDeleted = sum.NewWarnEvent[UserID](capitan.Signal("user.deleted"))
    LoginFailed = sum.NewErrorEvent[LoginAttempt](capitan.Signal("auth.failed"))
)
```

Constructors by severity:
- `NewDebugEvent[T]` — Development/verbose events
- `NewInfoEvent[T]` — Normal operations
- `NewWarnEvent[T]` — Potential issues
- `NewErrorEvent[T]` — Failures
- `NewEvent[T](signal, severity)` — Custom severity

## Emitting Events

```go
UserCreated.Emit(ctx, User{ID: "123", Email: "user@example.com"})
```

Internally, this calls the appropriate capitan function based on severity:

```go
// For Info level
capitan.Info(ctx, e.Signal, e.Key.Field(data))
```

## Listening for Events

```go
listener := UserCreated.Listen(func(ctx context.Context, u User) {
    log.Printf("User created: %s", u.Email)
})

// Clean up when done
defer listener.Close()
```

The listener receives the typed payload, extracted via the generic key.

## One-Time Listeners

```go
UserCreated.ListenOnce(func(ctx context.Context, u User) {
    log.Printf("First user: %s", u.ID)
})
```

Automatically unregisters after the first event.

## Direct capitan Usage

For lower-level control, use capitan directly:

```go
import "github.com/zoobzio/capitan"

// Define signal and key
var (
    signal = capitan.Signal("custom.event")
    key    = capitan.NewKey[CustomData]("data", capitan.Variant("custom"))
)

// Emit
capitan.Info(ctx, signal, key.Field(data))

// Listen
capitan.Hook(signal, func(ctx context.Context, ev *capitan.Event) {
    if data, ok := key.From(ev); ok {
        // handle data
    }
})
```

## Registry Signals

Sum re-exports signals from slush for registry events:

```go
var (
    SignalRegistered capitan.Signal = slush.SignalRegistered
    SignalAccessed   capitan.Signal = slush.SignalAccessed
    SignalDenied     capitan.Signal = slush.SignalDenied
    SignalNotFound   capitan.Signal = slush.SignalNotFound
)
```

Listen to these for observability:

```go
capitan.Hook(sum.SignalAccessed, func(ctx context.Context, ev *capitan.Event) {
    iface, _ := sum.KeyInterface.From(ev)
    metrics.ServiceAccessed(iface)
})
```

## Field Keys

Sum re-exports field keys for extracting data from registry events:

```go
var (
    KeyInterface capitan.Key = slush.KeyInterface // service interface name
    KeyImpl      capitan.Key = slush.KeyImpl      // implementation type name
    KeyError     capitan.Key = slush.KeyError     // error (for denied/not found)
)
```

## Next Steps

- [scio Integration](5.scio.md) — Data catalog
- [Events Guide](../2.guides/4.events.md) — Usage patterns
- [capitan Documentation](https://pkg.go.dev/github.com/zoobzio/capitan)
