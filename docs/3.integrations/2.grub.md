---
title: grub Integration
description: Database, key-value, and object storage integration
author: zoobzio
published: 2026-01-26
updated: 2026-01-26
tags:
  - integration
  - database
  - grub
  - storage
---

# grub Integration

[grub](https://github.com/zoobzio/grub) provides type-safe data access for SQL databases, key-value stores, and object storage. Sum's data helpers wire grub stores to the service registry and data catalog.

## What grub Provides

- `Database[M]` — SQL database operations with typed models
- `Store[M]` — Key-value store operations
- `Bucket[M]` — Object storage operations
- `Atomic` — Transaction/operation boundary abstraction

## The Integration

Sum provides three wrapper types that:

1. Embed the underlying grub store
2. Register the atomic with the data catalog on creation

| Sum Type | grub Type | Catalog Prefix |
|----------|-----------|----------------|
| `sum.Database[M]` | `grub.Database[M]` | `db://` |
| `sum.Store[M]` | `grub.Store[M]` | `kv://` |
| `sum.Bucket[M]` | `grub.Bucket[M]` | `bcs://` |

## Database Integration

For SQL databases:

```go
import (
    "github.com/jmoiron/sqlx"
    "github.com/zoobzio/astql"
    "github.com/zoobzio/sum"
)

type User struct {
    ID    string `db:"id"`
    Email string `db:"email"`
}

// Create wrapper (registers with catalog)
database, err := sum.NewDatabase[User](
    db,           // *sqlx.DB
    "users",      // table name
    renderer,     // astql.Renderer for your dialect
)

// Embed in your own type for custom methods
type UserRepository struct {
    *sum.Database[User]
}

userRepo := &UserRepository{Database: database}
```

The `astql.Renderer` handles SQL dialect differences (Postgres, MySQL, etc.).

## Store Integration

For key-value stores:

```go
// Create wrapper (registers with catalog)
store := sum.NewStore[Session](
    provider,     // grub.StoreProvider
    "sessions",   // store name
)

// Embed in your own type for custom methods
type SessionStore struct {
    *sum.Store[Session]
}

sessionStore := &SessionStore{Store: store}
```

The `StoreProvider` abstracts the underlying KV system (Redis, etcd, etc.).

## Bucket Integration

For object storage:

```go
// Create wrapper (registers with catalog)
bucket := sum.NewBucket[Document](
    provider,     // grub.BucketProvider
    "documents",  // bucket name
)

// Embed in your own type for custom methods
type DocumentStore struct {
    *sum.Bucket[Document]
}

docStore := &DocumentStore{Bucket: bucket}
```

The `BucketProvider` abstracts the storage backend (S3, GCS, filesystem).

## Atomic Operations

Each grub store exposes an `Atomic` for the data catalog:

```go
gdb, _ := grub.NewDatabase[User](db, "users", renderer)

// The atomic tracks operations for observability
atomic := gdb.Atomic()
```

Sum's wrapper types register these automatically. Access them via the catalog:

```go
catalog := svc.Catalog()
```

## Direct grub Usage

For advanced cases, use grub directly and register manually:

```go
// Create store directly
gdb, err := grub.NewDatabase[User](db, "users", renderer)
if err != nil {
    return err
}

// Manual catalog registration
svc.Catalog().RegisterDatabase("db://users", gdb.Atomic())
```

This is equivalent to what `sum.NewDatabase` does internally.

## Next Steps

- [fig Integration](3.fig.md) — Configuration loading
- [Data Stores Guide](../2.guides/5.data-stores.md) — Usage patterns
- [grub Documentation](https://pkg.go.dev/github.com/zoobzio/grub)
