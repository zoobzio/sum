---
title: fig Integration
description: Configuration loading with environment variables and secrets
author: zoobzio
published: 2026-01-26
updated: 2026-01-26
tags:
  - integration
  - configuration
  - fig
  - secrets
---

# fig Integration

[fig](https://github.com/zoobzio/fig) loads configuration from environment variables with support for secrets. Sum's `Config` helper loads configuration and registers it as a retrievable service.

## What fig Provides

- Environment variable binding via struct tags
- Required field validation
- Secret resolution from external providers
- Nested struct support

## The Integration

Sum's `Config` function:

1. Loads configuration via fig
2. Registers it with the service registry

```go
err := sum.Config[AppConfig](ctx, k, secretProvider)
```

After this call, retrieve the config anywhere:

```go
cfg := sum.MustUse[AppConfig](ctx)
```

## Basic Usage

Define a config struct with `env` tags:

```go
type AppConfig struct {
    Host     string `env:"HOST" default:"localhost"`
    Port     int    `env:"PORT" default:"8080"`
    LogLevel string `env:"LOG_LEVEL" default:"info"`
}

k := sum.Start()
err := sum.Config[AppConfig](ctx, k, nil)
if err != nil {
    log.Fatalf("config error: %v", err)
}
sum.Freeze(k)

// Use it
cfg := sum.MustUse[AppConfig](ctx)
fmt.Printf("Listening on %s:%d\n", cfg.Host, cfg.Port)
```

## Required Fields

Mark fields as required:

```go
type DatabaseConfig struct {
    URL string `env:"DATABASE_URL,required"`
}
```

`Config` returns an error if required fields are missing.

## Secrets

For sensitive values, use the `secret` tag with a secret provider:

```go
type AppConfig struct {
    APIKey string `env:"API_KEY" secret:"true"`
}

// With a secret provider
err := sum.Config[AppConfig](ctx, k, vaultProvider)
```

The secret provider resolves the value from your secrets backend.

### Without Secrets

Pass `nil` if you don't need secret resolution:

```go
err := sum.Config[AppConfig](ctx, k, nil)
```

## Nested Structs

fig supports nested configuration:

```go
type Config struct {
    Server   ServerConfig
    Database DatabaseConfig
    Redis    RedisConfig
}

type ServerConfig struct {
    Host string `env:"SERVER_HOST"`
    Port int    `env:"SERVER_PORT"`
}

type DatabaseConfig struct {
    URL string `env:"DATABASE_URL"`
}
```

## Multiple Configs

Register multiple config types:

```go
k := sum.Start()

err := sum.Config[ServerConfig](ctx, k, nil)
err = sum.Config[DatabaseConfig](ctx, k, nil)
err = sum.Config[RedisConfig](ctx, k, nil)

sum.Freeze(k)

// Retrieve each by type
serverCfg := sum.MustUse[ServerConfig](ctx)
dbCfg := sum.MustUse[DatabaseConfig](ctx)
```

## Direct fig Usage

For advanced cases, use fig directly:

```go
import "github.com/zoobzio/fig"

var cfg AppConfig
err := fig.LoadContext(ctx, &cfg, secretProvider)
if err != nil {
    return err
}

// Manual registration
sum.Register[AppConfig](k, cfg)
```

This is equivalent to what `sum.Config` does internally.

## Next Steps

- [capitan Integration](4.capitan.md) â€” Events and signals
- [fig Documentation](https://pkg.go.dev/github.com/zoobzio/fig)
